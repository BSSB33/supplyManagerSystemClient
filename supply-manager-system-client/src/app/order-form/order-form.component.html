<form [formGroup]="orderForm" (submit)="submit()">
  <div style="margin: 20px;">
    <h1>Edit order</h1>
  </div>
  <div *ngIf="order" class="card" style="width: 40rem; margin: 20px;">
    <div class="card-body">
      <h2 class="font-weight-bold mb-3">Order: {{order.productName}}</h2>
    </div>

    <ul class="list-group list-group-flush">

      <li class="list-group-item">
       <label class="whiteLabel">Product Name:
        <mat-form-field style="width: 200px;">
            <input matInput 
            #title
            formControlName="productName" 
            [(ngModel)] = "order.productName"
            type="text" 
            name="productName"
            placeholder="Enter Product Name"
            aria-describedby="titleHelp" />
          </mat-form-field>
        </label>
      </li>

      <li class="list-group-item">
        <label class="whiteLabel">Product Price:
          <mat-form-field style="width: 200px;">
              <input matInput 
              #productPrice 
              formControlName="price" 
              [(ngModel)]="order.price"
              type="text" 
              name="productPrice" 
              placeholder="Set Price"
              aria-describedby="titleHelp" />
          </mat-form-field>
        </label>
      </li>

      <li class="list-group-item">
        <label>Product Status:&nbsp;
          <mat-form-field style="width: 200px;">
              <mat-select
              #productStatus 
              formControlName="status" 
              [(ngModel)] = "order.status"
              name="productStatus" 
              placeholder="Enter Status">
                  <mat-option value="NEW">New</mat-option>
                  <mat-option value="SUCCESSFULLY_COMPLETED">Successfully Completed</mat-option>
                  <mat-option value="UNDER_PRODUCTION">Under Production</mat-option>
                  <mat-option value="UNDER_SHIPPING">Under Shipping</mat-option>
                  <mat-option value="CLOSED">Closed</mat-option>
                  <mat-option value="OFFER">Offer</mat-option>
                  <mat-option value="IN_STOCK">In Stock</mat-option>
                  <mat-option value="ISSUE">Issue</mat-option>
                  <mat-option value="UNDER_ASSEMBLY">Under Assembly</mat-option>
              </mat-select>
          </mat-form-field>
        </label>
      </li>

      <!-- === Seller === -->
      <li class="list-group-item" *ngIf="order.seller.id === authService.user.workplace.id && authService.user.role !== 'ROLE_ADMIN'">
        <label>Seller Manager:&nbsp;
          <mat-form-field *ngIf="order.sellerManager; else unassignedSeller" style="width: 200px;">
              <mat-select 
                #sellerManager 
                formControlName="sellerManager" 
                name="sellerManager" 
                placeholder="Select Seller Manager"
                [(ngModel)]="order.sellerManager.username">
                  <mat-option value="" disabled>Choose a User</mat-option>
                  <ng-container *ngFor="let user of managers">
                      <mat-option *ngIf="user.enabled"
                      [value]="user.username">{{user.username}}
                      </mat-option>
                  </ng-container>
              </mat-select>
          </mat-form-field>
        </label>
      </li>

      <ng-template #unassignedSeller>
        <mat-form-field style="width: 200px;">
          <mat-select 
            #sellerManager 
            formControlName="sellerManager" 
            name="sellerManager" 
            placeholder="Select Seller Manager">
              <mat-option value="" disabled>Choose a User</mat-option>
              <ng-container *ngFor="let user of managers">
                  <mat-option *ngIf="user.enabled"
                  [value]="user.username">{{user.username}}
                  </mat-option>
              </ng-container>
          </mat-select>
        </mat-form-field>
    </ng-template>


    <!-- === Buyer === -->
    <li class="list-group-item" *ngIf="order.buyer.id === authService.user.workplace.id && authService.user.role !== 'ROLE_ADMIN'">
      <label>Buyer Manager:&nbsp;
        <mat-form-field *ngIf="order.buyerManager; else unassignedBuyer" style="width: 200px;">
            <mat-select 
            #buyerManager 
            formControlName="buyerManager" 
            name="buyerManager" 
            placeholder="Select Buyer Manager"
            [(ngModel)]="order.buyerManager.username">
                <mat-option value="" disabled>Choose a User</mat-option>
                <ng-container *ngFor="let user of managers">
                    <mat-option *ngIf="user.enabled"
                    [value]="user.username">{{user.username}}
                    </mat-option>
                </ng-container>
            </mat-select>
        </mat-form-field>
      </label>
    </li>

    <ng-template #unassignedBuyer>
      <mat-form-field style="width: 200px;">
        <mat-select
            #buyerManager 
            formControlName="buyerManager" 
            name="buyerManager" 
            placeholder="Select Buyer Manager">
          <mat-option value="" disabled>Choose a User</mat-option>
          <ng-container *ngFor="let user of managers">
              <mat-option *ngIf="user.enabled"
              [value]="user.username">{{user.username}}
              </mat-option>
          </ng-container>
        </mat-select>
      </mat-form-field>
    </ng-template>

    <!-- === Admin page === -->

    <li class="list-group-item" *ngIf="authService.user.role === 'ROLE_ADMIN'">
      <label>Seller Company:&nbsp;
        <mat-form-field *ngIf="order.seller" style="width: 200px;">
            <mat-select 
              #seller
              formControlName="seller" 
              name="seller" 
              placeholder="Select Seller Company"
              [(ngModel)]="order.seller.name">
                <mat-option value="" disabled>Choose a Company</mat-option>
                <ng-container *ngFor="let company of companies">
                  <mat-option *ngIf="company.active"
                    [value]="company.name"
                    (click)="filterUsersOfSellerCompany(company.name)">{{company.name}}
                 </mat-option>
                </ng-container>
            </mat-select>
        </mat-form-field>
      </label>
    </li>

    <li class="list-group-item" *ngIf="authService.user.role === 'ROLE_ADMIN'">
      <label>Seller Manager:&nbsp;
        <mat-form-field *ngIf="order.sellerManager" style="width: 200px;">
            <mat-select 
              #sellerManager
              formControlName="sellerManager" 
              name="sellerManager" 
              placeholder="Select Seller Manager"
              [(ngModel)]="order.sellerManager.username">
                <mat-option value="" disabled>Choose a Manager</mat-option>
                <ng-container *ngFor="let manager of usersOfSellerCompany">
                  <mat-option *ngIf="manager.enabled"
                    [value]="manager.username">{{manager.username}}
                 </mat-option>
                </ng-container>
            </mat-select>
        </mat-form-field>
      </label>
    </li>

    <li class="list-group-item" *ngIf="authService.user.role === 'ROLE_ADMIN'">
      <label>Buyer Company:&nbsp;
        <mat-form-field *ngIf="order.buyer" style="width: 200px;">
            <mat-select 
              #buyer
              formControlName="buyer" 
              name="buyer" 
              placeholder="Select Buyer Company"
              [(ngModel)]="order.buyer.name"> <!--onload="filterUsersOfBuyerCompany(company.name)"-->
                <mat-option value="" disabled>Choose a Company</mat-option>
                <ng-container *ngFor="let company of companies">
                  <mat-option *ngIf="company.active"
                   [value]="company.name"
                   (click)="filterUsersOfBuyerCompany(company.name)">{{company.name}}
                  </mat-option>
                </ng-container>
            </mat-select>
        </mat-form-field>
      </label>
    </li>

    <li class="list-group-item" *ngIf="authService.user.role === 'ROLE_ADMIN'">
      <label>Buyer Manager:&nbsp;
        <mat-form-field *ngIf="order.buyerManager" style="width: 200px;"> <!-- TODO mi van ha nincs? (ng-template) -->
            <mat-select 
              #buyerManager
              formControlName="buyerManager" 
              name="buyerManager" 
              placeholder="Select Buyer Manager"
              [(ngModel)]="order.buyerManager.username">
                <mat-option value="" disabled>Choose a Manager</mat-option>
                <ng-container *ngFor="let manager of usersOfBuyerCompany">
                  <mat-option *ngIf="manager.enabled"
                    [value]="manager.username">{{manager.username}}
                 </mat-option>
                </ng-container>
            </mat-select>
        </mat-form-field>
      </label>
    </li>


    </ul>
    <div class="card-body">
      <button [routerLink]="['/orders/edit', order.id]" mat-raised-button [disabled]="!orderForm.valid" color="primary"
      type="submit">Save Order</button>
    </div>
  </div>


</form>

<div><button mat-raised-button color="primary" class="backButton" (click)="goBack()">Back</button></div>